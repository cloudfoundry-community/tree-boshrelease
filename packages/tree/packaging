#!/bin/bash

set -eu

# Available variables
# $BOSH_COMPILE_TARGET - where this package & spec'd source files are available
# $BOSH_INSTALL_TARGET - where you copy/install files to be included in package
export HOME=/var/vcap

baseDir=$BOSH_INSTALL_TARGET
sourceList="$baseDir/apt/sources/sources.list"
trustedKeys="$baseDir/apt/etc/trusted.gpg"
cacheDir="$baseDir/apt/cache"
stateDir="$baseDir/apt/state"
options="-o debug::nolocking=true -o dir::cache=$cacheDir -o dir::state=$stateDir -o dir::etc::sourcelist=$sourceList -o dir::etc::trusted=$trustedKeys"

mkdir -p "$(dirname $sourceList)"
mkdir -p "$(dirname $trustedKeys)"
mkdir -p "$cacheDir"
mkdir -p "$stateDir"
cp /etc/apt/sources.list "$sourceList"
cp /etc/apt/trusted.gpg "$trustedKeys"

set -x

apt-get update ${options}
apt-get install ${options} -y -d tree